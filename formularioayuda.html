<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Ayuda</title>
  
  <!-- Fuente moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body { 
      font-family: 'Poppins', sans-serif; 
      background: #f0f4f8; 
      margin: 0; 
      padding: 0; 
      color: #333;
    }

    section { padding: 3rem 1rem; }
    .container { 
      max-width: 700px; 
      margin: auto; 
      background: #fff; 
      padding: 2.5rem; 
      border-radius: 16px; 
      box-shadow: 0 6px 18px rgba(0,0,0,0.08); 
    }

    h2 { 
      text-align: center; 
      margin-bottom: 2rem; 
      font-size: 1.8rem; 
      color: #1e3a8a; 
    }

    label { 
      font-weight: 500; 
      display: block; 
      margin-bottom: 0.5rem; 
      color: #374151; 
    }

    input, select, textarea { 
      width: 100%; 
      padding: 0.75rem 1rem; 
      margin-bottom: 1.2rem; 
      border: 1px solid #d1d5db; 
      border-radius: 10px; 
      font-size: 0.95rem; 
      transition: border 0.2s ease; 
      background: #f9fafb;
    }

    input:focus, select:focus, textarea:focus { 
      outline: none; 
      border: 1px solid #2563eb; 
      background: #fff;
    }

    button { 
      background: #2563eb; 
      color: white; 
      border: none; 
      padding: 0.9rem; 
      width: 100%; 
      border-radius: 10px; 
      cursor: pointer; 
      font-size: 1rem; 
      font-weight: 600;
      transition: background 0.3s ease, transform 0.1s ease;
    }

    button:hover { 
      background: #1e40af; 
      transform: translateY(-2px);
    }

    /* Previews */
    #preview { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 12px; 
      margin-top: 12px; 
    }

    .thumbnail-container { 
      position: relative; 
      display: inline-block; 
    }

    .thumbnail { 
      width: 110px; 
      height: 110px; 
      object-fit: cover; 
      border-radius: 12px; 
      border: 1px solid #d1d5db; 
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }

    .thumbnail:hover {
      transform: scale(1.05);
    }

    .remove-btn { 
      position: absolute; 
      top: -6px; 
      right: -6px; 
      background: #ef4444; 
      color: white; 
      border: none; 
      border-radius: 50%; 
      width: 22px; 
      height: 22px; 
      cursor: pointer; 
      font-size: 14px; 
      font-weight: bold;
      line-height: 1; 
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>

<!-- FORMULARIO DE AYUDA -->
<section id="soporte">
  <div class="container">
    <h2>Formulario de Ayuda</h2>
    <form id="formAyuda">

      <!-- Nombre -->
      <label for="nombre">Nombre del solicitante:</label>
      <input type="text" id="nombre" name="nombre" required>

      <!-- Correo -->
      <label for="correo">Correo electrónico:</label>
      <input type="email" id="correo" name="correo" required placeholder="tuemail@ejemplo.com">

      <!-- Selección de destinatario -->
      <label for="destinatario">Selecciona a quién deseas contactar:</label>
      <select id="destinatario" name="destinatario" required>
        <option value="" disabled selected>-- Selecciona un contacto --</option>
        <option value="administracion@dsm.edu.ni">Director Administrativo</option>
        <option value="direccion.general@dsm.edu.ni">Director General</option>
        <option value="direccion.primaria@dsm.edu.ni">Directora Primaria</option>
        <option value="direccion.kindergarten@dsm.edu.ni">Directora Kindergarten</option>
        <option value="subdireccion.nacional@dsm.edu.ni">Subdirección Nacional</option>
        <option value="secretaria.academica@dsm.edu.ni">Secretaría Académica</option>
        <option value="dsc@dsm.edu.ni">Club Deportivo</option>
        <option value="admisiones@dsm.edu.ni">Admisiones</option>
        <option value="informatica@dsm.edu.ni">Informática</option>
        <option value="difusiondsm@dsm.edu.ni">Marketing</option>
      </select>

      <!-- Mensaje -->
      <label for="mensaje">¿En qué necesitas ayuda?</label>
      <textarea id="mensaje" name="mensaje" rows="4" required></textarea>

      <!-- Archivos -->
      <label for="archivo">Adjuntar capturas (puedes seleccionar varias):</label>
      <input type="file" id="archivo" name="archivo" multiple>
      <div id="preview"></div>

      <!-- Botón -->
      <button type="submit">Enviar solicitud</button>
    </form>
  </div>
</section>

<script>
const form = document.getElementById('formAyuda');
const inputArchivo = document.getElementById('archivo');
const preview = document.getElementById('preview');
let archivos = [];

// Previsualización de archivos
inputArchivo.addEventListener('change', () => {
  const nuevos = Array.from(inputArchivo.files);
  archivos = archivos.concat(nuevos);
  mostrarPreviews();
  inputArchivo.value = '';
});

function mostrarPreviews() {
  preview.innerHTML = '';
  archivos.forEach((file, index) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const cont = document.createElement('div');
      cont.className = 'thumbnail-container';

      const img = document.createElement('img');
      img.src = e.target.result;
      img.className = 'thumbnail';

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.textContent = '×';
      btn.className = 'remove-btn';
      btn.addEventListener('click', () => {
        archivos.splice(index, 1);
        mostrarPreviews();
      });

      cont.appendChild(img);
      cont.appendChild(btn);
      preview.appendChild(cont);
    };
    reader.readAsDataURL(file);
  });
}

// Envío al Google Apps Script
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const payload = {
    nombre: form.nombre.value,
    correo: form.correo.value,
    destinatario: form.destinatario.value,
    mensaje: form.mensaje.value
  };

  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbzO8UF-r-yGj18r9DTJ1Dg-y0CAkQ_INk5ULzqefmc_UMQ3sXuDcLqmKg554NFjn7Yc/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const result = await response.json();
    if (result.status === "ok") {
      alert("✅ Tu solicitud fue enviada correctamente");
      form.reset();
      archivos = [];
      preview.innerHTML = '';
    } else {
      alert("❌ Hubo un error: " + result.message);
    }
  } catch (err) {
    alert("⚠️ No se pudo conectar con el servidor");
    console.error(err);
  }
});
</script>


</body>
</html>
